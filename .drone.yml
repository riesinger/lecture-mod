pipeline:
  build:
    image: golang:1.10.2-alpine
    environment:
      - CGO_ENABLED=0
      - GOOS=linux
      - GOPATH=/drone/
    commands:
      - apk add --update git
      - go get -v 
      - go vet -v
      - go build -v -a -installsuffix cgo -o lecture-mod .
  publish-docker:
    image: docker
    secrets: [ docker_username, docker_password ]
    commands:
      - docker login --username=$DOCKER_USERNAME --password=$DOCKER_PASSWORD registry.pascal-riesinger.de
      - docker build -t registry.pascal-riesinger.de/lecture-mod:latest .
      - docker push registry.pascal-riesinger.de/lecture-mod:latest
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    when:
      branch: master
      event: push
  
